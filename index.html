<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>My Photos</title>

	<!-- Bootstrap -->
	<link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="lib/multiselect/css/bootstrap-multiselect.css">
	<link rel="stylesheet" href="lib/bootstrap-table/dist/bootstrap-table.css">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css">

	<!-- App -->
	<link rel="stylesheet" href="css/my.css">
</head>
<body>
	<div id='container'></div>
	<script id='template' type='text/ractive'>
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="container-fluid">
				<div class="navbar-header">

					<!-- Back/Close buttons -->
					{{#if photoid !== false}}
						<button on-click="close" type="button" class="btn btn-default navbar-btn pull-left">
							<span class="glyphicon glyphicon-remove"></span> {{t('close')}}
						</button>
						{{else}}
						{{#if view == 'album'}}
						<a href="#{{folder.parentpath}}" class="btn btn-default navbar-btn pull-left">
							<span class="glyphicon glyphicon-chevron-left"></span> {{t('back')}}
						</a>
						{{/if}}
					{{/if}}
					
					<!-- Collapsible button -->
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#collapsible">
						<span class="sr-only">Toggle navigation</span>
						 <span class="icon-bar"></span>
						 <span class="icon-bar"></span>
						 <span class="icon-bar"></span>
					</button>
					
					<!-- App/Folder/File title -->
					<div class="{{#if view !== 'album'}}hide{{/if}} pull-left">
						<a class="{{#if !user.isadmin}}hide{{/if}} navbar-brand addtooltip" data-i18n="[title]folder_opt"
						   data-toggle="modal" href="#folderModal">
							{{folder.name}}
						</a>
						<span class="{{#if user.isadmin}}hide{{/if}} navbar-brand">{{folder.name}}</span>
					</div>
					{{#if view == 'home'}}
						<span class="navbar-brand">MyPhotos</span>
					{{elseif view == 'photo'}}
						<span class="navbar-brand">{{photos[photoid].filename}}</span>
					{{/if}}
					
					
				</div>

				<div class="collapse navbar-collapse" id="collapsible">
					<ul class="nav navbar-nav navbar-right">
						
						<!-- Action buttons -->
						<li class="{{#if !user.isadmin || view !== 'photo'}}hide{{/if}} {{#if photos[photoid].hidden}}active{{/if}}">
							<a class="addtooltip" data-i18n="[title]hide" href="#" on-click="hide">
								<span class="glyphicon glyphicon-eye-close"></span>
							</a>
						</li>
						<li class="{{#if !user.isadmin || view !== 'photo'}}hide{{/if}}">
							<a class="addtooltip" data-i18n="[title]set_cover" href="#" on-click="cover">
								<span class="glyphicon glyphicon-picture"></span>
							</a>
						</li>
						<li class="dropdown {{#if view !== 'photo'}}hide{{/if}}">
							<a href="#" class="dropdown-toggle addtooltip" data-i18n="[title]dl_photo" data-toggle="dropdown" role="button">
								<span class="glyphicon glyphicon-download-alt"></span>
							</a>
							<ul class="dropdown-menu" role="menu">
								{{#photos[photoid]}}
								<li><a href="{{photos[photoid].previewurl}}&d=1">
									<span class="glyphicon glyphicon-file"></span> {{t('big')}} ({{previewsize}})</a>
								</li>
								<li><a href="{{photos[photoid].fileurl}}&d=1">
									<span class="glyphicon glyphicon-file"></span> {{t('original')}} ({{size}})</a>
								</li>
								{{/if}}
							</ul>
						</li>
						<div class="modal fade" id="folderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
										<h4 class="modal-title" id="myModalLabel">{{t('folder_opt')}}</h4>
									</div>
									<div class="modal-body">
										<div class="form-group">
											<input type="text" class="form-control" value="{{folder.name}}" placeholder="{{t('album_name')}}">
										</div>
										<p>Define the visiblity for album <strong>{{folder.name}}</strong></p>
										<div class="radio">
											<label>
												<input type="radio" name="{{folder.visibility}}" value="private" checked>
												<span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Private
												<p class="help-block">Only visible by Admin accounts.</p>
											</label>
										</div>
										<div class="radio">
											<label>
												<input type="radio" name="{{folder.visibility}}" value="public">
												<span class="glyphicon glyphicon-globe" aria-hidden="true"></span> Public
												<p class="help-block">Visible by everyone without authentication.</p>
											</label>
										</div>
										<div class="radio">
											<label>
												<input type="radio" name="{{folder.visibility}}" value="restricted">
												<span class="glyphicon glyphicon-user" aria-hidden="true"></span> Restricted
												<p class="help-block">Visible by a selection of groups</p>
											</label>
										</div>
										<div class="col-md-offset-1 {{#if folder.visibility !== 'restricted'}}hide{{/if}}">
											<select id="foldergroups" value='{{folder.groups}}' multiple="multiple">
												  {{#each groups}}
												  	<option>{{this}}</option>
												  {{/each}}
											</select>
										</div>
										<div class="checkbox">
											<label>
												<input type="checkbox" value="">
												Apply recursively to all sub-albums
											</label>
										</div>
									</div>
									<div class="modal-footer">
										<small>Changes are saved automatically.</small>
									</div>
								</div>
							</div>
						</div>
						<li data-i18n="[title]sign-in" class="addtooltip g-signin {{#if user}}hide{{/if}}">
							<span class="g-signin"
								data-width="wide"
								data-scope="https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/userinfo.email"
								data-clientid="320030776284-01dr10ur7ni4opbjgum9g266vrn29u4f.apps.googleusercontent.com"
								data-redirecturi="postmessage"
								data-cookiepolicy="single_host_origin"
								data-callback="signInCallback">
							</span>
						</li>
						{{#user}}
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">{{displayName}} <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								{{#isadmin}}
								<li><a data-toggle="modal" href="#cronModal"><span class="glyphicon glyphicon-retweet"></span> Update Library</a></li>
								<li><a data-toggle="modal" href="#groupsModal"><span class="glyphicon glyphicon-user"></span> Groups & people</a></li>
								<li><a on-click="checkupdates" href="#"><span class="glyphicon glyphicon-circle-arrow-up"></span> {{t('check_updates')}}</a></li>
								{{/if}}
								<li><a target="_blank" href="https://github.com/alexylem/myphotos/issues/new"><span class="glyphicon glyphicon-fire"></span> {{t('report-issue')}}</a></li>
								<li><a on-click="logout" href="#"><span class="glyphicon glyphicon-log-out"></span> {{t('sign-off')}}</a></li>
							</ul>
						</li>
						{{/if}}
						<div class="modal fade" id="cronModal" tabindex="-1" role="dialog">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
										<h4 class="modal-title">Update Library</h4>
									</div>
									<div class="modal-body">
										<div class="progress">
										  {{#if cron.striped}}
											  <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%">
											  </div>
										  {{else}}
										  	<div class="progress-bar progress-bar-{{cron.class}} active" role="progressbar" style="width: {{cron.progress}}%">
											</div>
										  {{/if}}
										</div>
										<p class="text-{{cron.class}}">{{cron.status}}</p>
									</div>
									<div class="modal-footer">
										{{#if cron.class == 'danger'}}
											<button type="button" class="btn btn-default" on-click="ignore">Ignore</button>
										{{/if}}
									</div>
								</div>
							</div>
						</div>
						<div class="modal fade" id="groupsModal" tabindex="-1" role="dialog">
							<div class="modal-dialog modal-lg">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
										<h4 class="modal-title" id="myModalLabel">Groups</h4>
									</div>
									<div class="modal-body">
										{{#if groups}}
										<div class="btn-toolbar">
										{{#each groups:i}}
											<div class="btn-group">
												<button type="button" class="btn btn-warning btn-sm {{#if userfilter == this}}active{{/if}}" on-click="filterpeople:{{this}}">{{this}}</button>
												<button type="button" class="btn btn-default btn-sm" on-click="removegroup:{{i}}"><span class="glyphicon glyphicon-remove"></span></button>
											</div>
										{{/each}}
										</div>
										<br />
										{{else}}
										
										<div class="alert alert-info well-sm">
												Start by adding some Groups below
											</div>

										{{/if}}
										<form id="addgroupform" class="form-inline">
											<div class="form-group">
										      <input type="text" class="form-control input-sm" value="{{newgroup}}" placeholder="ex: Family" required>
										       <button class="btn btn-info btn-sm" type="submit"><span class="glyphicon glyphicon-plus"></span></button>
										    </div>
										</form>
										<hr />
										<h4>People</h4>
										{{#if userfilter}}
											<div class="well well-sm pull-left">
												Showing people in {{userfilter}} <a href="#" class="alert-link" on-click="filterpeople:false">See all</a>
											</div>
										{{/if}}
										<table
											id="users"
											data-classes="table table-hover table-no-bordered"
											data-striped="true"
											data-page-size="5"
											data-show-pagination-switch="true">
										</table>
										<!--
										<form class="form-inline" on-submit="adduser">
										  <div class="form-group">
										    <input type="text" class="form-control input-sm" value="{{newname}}" placeholder="ex: Mum">
										  </div>
										  <div class="form-group">
										    <input type="email" class="form-control input-sm" value="{{newemail}}" placeholder="ex: email@gmail.com">
										  </div>
										  <div class="form-group">
										    <select id="multiselect" class="form-control input-sm" value='{{newgroups}}' multiple="multiple">
												  {{#each groups}}
												  	<option>{{this}}</option>
												  {{/each}}
											</select>
										  </div>
										  <button type="submit" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-plus"></span></button>
										</form>
										-->
									</div>
									<div class="modal-footer">
										<small>Changes are saved automatically.</small>
									</div>
								</div>
							</div>
						</div>
					</ul>
				</div>
			</div>
		</nav>
	<div class="container">

	{{#if view == 'loading'}}
		<p class="text-center">
			<span class="glyphicon glyphicon-refresh rotate"></span> {{t('loading')}}
		</p>

	{{elseif view == 'photo'}}
		<button on-click="previous" type="button" class="btn btn-default btn-lg prev"
		{{#unless photoid}} disabled="disabled" {{/unless}}>
			<span class="glyphicon glyphicon-chevron-left"></span>
		</button>
		{{#photos[photoid]}}
			{{#if type == 'image'}}
				<div class="view" style="background-image: url('{{previewurl}}');">
				</div>
			{{elseif type == 'video'}}
				<div class="view">
					<iframe class="video" width="100%" height="100%" src="{{previewurl}}" frameborder="0" allowfullscreen="true">
					</iframe>
				</div>
			{{/if}}
		{{/}}
		<button on-click="next" type="button" class="btn btn-default btn-lg nxt"
		{{#if photoid == photos.length-1}} disabled="disabled" {{/if}}>
			<span class="glyphicon glyphicon-chevron-right"></span>
		</button>
	{{else}}
		{{#if folders}}
			<h5>{{t('albums')}}</h5>
			{{#each folders}}
			<div class="thumb stack">
				<a href="#{{filepath}}" style="background-image: url('{{coverurl}}');">
					<div class="cover">
						<span class="glyphicon glyphicon-{{visibility == 'public' ? 'globe' : (visibility == 'restricted' ? 'user' : 'lock')}}"></span> {{filename}}
					</div>
				</a>
			</div>
			{{/each}}
			<div class="clearfix"></div>
			<hr />
			{{#if !user}}
				<div class="panel panel-default">
				  <div class="panel-body">
					 <h4><span class="glyphicon glyphicon-question-sign"></span> {{t('missing_albums')}}</h4>
					 <p>{{t('plz_sign_in')}}</p>
					 <p>
					 	{{t('no_google_account')}}
					 	<a href="https://accounts.google.com/SignUpWithoutGmail" target="_blank">
					 		{{t('create_google_account')}}
					 	</a>
					 </p>
					  </div>
				</div>
			{{/if}}
		{{elseif view == 'home'}}
			<div class="jumbotron">
			  <h1><span class="glyphicon glyphicon-eye-close"></span> {{t('oops')}}</h1>
			  <p>{{t('no_album_visible')}}</p>
			  <p>{{t('plz_sign_in')}}</p>
			</div>
		{{/if}}

		{{#if photos}}
			<h5>{{t('photos')}}</h5>
			{{#each photos}}
			<div class="thumb {{#if hidden}}private{{/if}}" style="background-image: url('{{thumburl}}');">
				<a href="#{{folder.filepath}}" on-click="view:{{@index}}"></a>
			</div>
			{{/each}}
			<div class="clearfix"></div>
			<hr />
		{{/if}}
		<p class="text-center text-muted">
			Powered by <a href="https://github.com/alexylem/myphotos#myphotos" target="_blank">MyPhotos</a>.
		</p>
	{{/if}}
</div>
</script>
<!-- Modernizr -->
<script src="lib/modernizr/modernizr.custom.69910.js"></script>

<!-- jQuery -->
<script src="lib/jquery/jquery-2.1.1.min.js"></script>
<script src="lib/validation/dist/jquery.validate.min.js"></script>

<!-- Localization -->
<script src='lib/i18next/i18next.min.js'></script>

<!-- Ractive -->
<script src='lib/ractive/ractive.js'></script>
<!--<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>-->

<!-- Bootstrap -->
<script src="lib/bootstrap/js/bootstrap.min.js"></script>
<script src="lib/multiselect/js/bootstrap-multiselect.js"></script>
<script src="lib/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="lib/bootstrap-table/dist/bootstrap-table.js"></script> <!-- https://github.com/wenzhixin/bootstrap-table/issues/839 -->
<script src="lib/bootstrap-table/dist/locale/bootstrap-table-fr-FR.min.js"></script>
<script src="lib/bootstrap-table/dist/extensions/editable/bootstrap-table-editable.min.js"></script>
<script src="lib/x-editable/dist/bootstrap3-editable/js/bootstrap-editable.min.js"></script>

<!-- Other Plugins -->
<script src="lib/filesize/filesize.min.js"></script>

<!-- My -->
<script src="js/utils.js"></script>
<script src="js/framework.js"></script>
<script src="repository.js"></script>
<script src="js/my.js"></script>

<!-- Async Google Plus sign-in library -->
<script src="https://apis.google.com/js/platform.js"></script>
<script src="https://apis.google.com/js/client:plusone.js"></script>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-29589045-4', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>